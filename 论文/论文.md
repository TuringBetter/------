# 基于LoRaWAN的交通灯预警系统
## 中文摘要
针对传统交通预警设备存在的功能单一、智能化水平低、无法对事故类型进行精确区分以及难以进行大规模联网管理等不足，本文设计并实现了一种基于LoRaWAN的智能交通灯预警系统。LoRaWAN技术以其远距离、低功耗、强抗干扰性的优势，为构建新一代智能交通系统提供了可行的通信方案。本系统由智能终端、嵌入式网关、ChirpStack网络服务器及HTTP应用服务器四部分构成，形成了一套“端-边-云”协同工作的完整架构。其中，智能终端集成了雷达与加速度传感器，并基于FreeRTOS实现了多任务并行处理；应用服务器则采用Go语言和Gin框架开发，负责业务逻辑处理与数据转发。本文重点阐述了系统在硬件选型、软件架构上的设计方案，并详细介绍了自主设计的事故检测算法、本地与云端协同的诱导灯状态管理算法以及轻量级时间同步管理机制。测试结果表明，该系统运行稳定，能够有效提升交通事件感知的精确性和应急响应的实时性。
### 中文关键词
交通管理；LoRaWAN；嵌入式网关；Gin框架；多传感器融合
## 英文摘要
To address the deficiencies of traditional traffic warning systems, such as single functionality, low intelligence, inability to accurately differentiate accident types, and difficulties in large-scale network management, this paper designs and implements an intelligent traffic light warning system based on LoRaWAN. The LoRaWAN technology, with its advantages of long-range communication, low power consumption, and strong anti-interference capabilities, provides a feasible solution for building next-generation intelligent transportation systems. The proposed system consists of four main components: intelligent terminals, an embedded gateway, a ChirpStack network server, and an HTTP application server, forming a complete architecture of "end-edge-cloud" collaboration. The intelligent terminal integrates radar and accelerometer sensors and implements multi-task parallel processing based on FreeRTOS. The application server is developed using Go language and the Gin framework, responsible for business logic processing and data forwarding. This paper focuses on the system's hardware selection and software architecture design, and provides a detailed description of the independently designed accident detection algorithm, a local-cloud collaborative induction light state management algorithm, and a lightweight time synchronization mechanism. Test results demonstrate that the system operates stably and can effectively improve the accuracy of traffic event perception and the real-time performance of emergency responses.
### 英文关键词
Traffic Management; LoRaWAN; Embedded Gateway; Gin Framework; Multi-Sensor Fusion
## 引言
随着城市化进程的加速和机动车保有量的持续增长，交通安全与效率问题日益凸显。传统的交通预警设备，如被动反光标志、单一功能的爆闪灯等，多采用有线供电或本地独立控制，存在部署成本高、功能固化、无法联网、维护困难等一系列问题。当道路发生突发事故或存在潜在危险时，这些传统设备难以进行实时、智能的预警，无法满足现代智能交通系统（ITS）的需求。

近年来，以ZigBee、Wi-Fi为代表的短距离无线通信技术虽在部分物联网场景得到应用，但其通信距离短、网络容量有限、易受干扰的特性，限制了其在广域、复杂的交通环境中的大规模部署。因此，寻求一种能够兼顾远距离、低功耗、大连接和高可靠性的通信技术，成为智能交通领域的研究热点。

LoRaWAN（Long Range Wide Area Network）作为低功耗广域网技术中的佼佼者，凭借其出色的通信距离、超低的终端功耗、强大的抗干扰能力以及标准化的开放协议，为解决上述问题提供了理想的方案。

本文基于LoRaWAN技术，设计并实现了一套完整的智能交通灯预警系统。本文内容介绍如下：首先介绍系统的总体框架，阐述终端、网关、网络服务器和应用服务器之间的协同工作关系；其次，详细介绍系统关键的硬件选型与设计；再次，重点阐述系统核心的软件设计，包括终端的多任务架构、创新的事故检测与状态管理算法，以及应用服务器的实现；最后，通过系统测试验证方案的可行性并进行总结。
## 1 系统框架
基于LoRaWAN的智能交通灯预警系统, 由LoRa终端、LoRa网关集中器以及ChirpStack服务、基于Go Gin的Http Server4个部分组成. 在LoRa终端上外接多种传感器, 能够将数据封装通过LoRaWAN数据帧传输至网关集中器；LoRa网关集中器能够并行接收处理多个终端节点的数据并通过UDP协议传输至服务器; 服务器结合ChirpStack服务与Http Server应用为用户呈现可视化监测与管理界面。系统框架如图1所示。
## 2 系统硬件设计
### 2.1 LoRa终端
LoRa终端系统采用以ESP32-S3为控制芯片的开发板作为控制器, 搭载传感器模块(SC7A20H三轴加速度计、RD-SRR236微波雷达)、LoRa通信模块(Ra-08-Kit,该模块基于ASR6601芯片)、WS2812B可编程RGB LED组成的24x48灯阵, 整个LoRa终端的硬件结构如图2所示。
### 2.2 LoRa网关集中器硬件系统结构
## 3 系统软件设计
### 3.1 LoRa终端入网与运行流程
### 3.2 LoRa终端诱导灯状态管理算法
### 3.3 LoRa终端时间同步算法
### 3.4 LoRa终端事故检测算法
### 3.5 LoRa网关集中器数据转发功能
LoRa网关集中器采用了“树莓派3B+E106-470G27P2模块+转接板”组合搭建而成, 其硬件结构如图所示。
![网关硬件图](./pics/网关硬件图.png)

E106-470G27P2是一款适配于树莓派的LoRa网关
集中器模块, 支持LoRa协议、LoRaWAN协议、SPI接口协议，支持8个信道, 并且适用于LoRaWAN全球所有频段, 它拥有一个基于Semtech SX1302的基带处理器用来进行数据包的管理

树莓派则主要负责作为核心控制板, 处理数据和运算等
### 3.6 ChirpStack服务部署与配置
ChirpStack是一个开源的物联网网络服务器，它提供了LoRaWAN协议的网络服务器功能，包含了Gateway Bridge、Network Server、Application Server和Geolocation Server, 并且集成了许多接口供第三方应用使用, 是目前LoRaWAN服务端中一个很好可行的解决方案。

本系统部署ChirpStack v4版本，v4版本提供了一个统一的docker-compose.yml文件，可以一键部署
### 3.7 Go Gin应用开发
### 3.8 系统数据通信流程
## 4 系统测试与总结